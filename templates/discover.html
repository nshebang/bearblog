{% extends 'base.html' %}

{% block title %}{% if newest %}Recientes{% else %}Populares{% endif %}@ichoria ‚òÜ blogs{% endblock %}

{% block seo %}
<meta name="robots" content="nofollow">
<link rel="alternate" type="application/atom+xml" href="/feed/{% if newest %}?newest=True{% endif %}">
<link rel="alternate" type="application/rss+xml" href="feed/?type=rss{% if newest %}&newest=True{% endif %}">
{% endblock %}

{% block nav %}
{% endblock %}

{% block content %}

<h1>
    Explorar blogs
</h1>
<nav>
    {% if not newest %}
    <b><a href="/discover/">Populares</a></b>
    <a href="/discover/?newest=true">M√°s recientes</a>
    {% else %}
    <a href="/discover/">Populares</a>
    <b><a href="/discover/?newest=true">M√°s recientes</a></b>
    {% endif %}
    <a href="/search/">Buscar</a>
</nav>

{% if request.user.is_staff %}
<p>
    <details style="font-size: small; color: grey;">
        <summary>Idioma ({% if lang %}{{ lang }}{% else %}Sin filtro{% endif %})</summary>
        <a href="{{ request.path }}" onclick="document.cookie='lang=; path=/;';">None</a>
        {% for language in available_languages %}
            {% if language %}
            <a href="{{ request.path }}" onclick="document.cookie='lang={{ language }}; path=/;';">{{ language }}</a>
            {% endif %}
        {% endfor %}
    </details>
</p>
{% endif %}

{% if newest %}
{% endif %}
<ul class="discover-posts">
    {% for post in posts %}
    <li>
        <span>
            #{{ forloop.counter|add:posts_from }}
        </span>
        <div>
            <a href="https://{{ post.blog.subdomain }}.ichoria.cc/{{ post.slug }}">
                {{ post.title }}
            </a>
            <small>
                <span>(<a href="https://{{ post.blog.subdomain }}.ichoria.cc">https://{{ post.blog.subdomain }}.ichoria.cc</a>)</span>
                <br>
                {% if post.pinned %}<small style="position: absolute; top:0; right:0;">üìç Pinned</small>{% endif %}
                <small>Published {{ post.published_date|timesince }} ago</small>
                <small>
                    <svg style="height:16px;margin: 0 -8px -4px 0;" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><polyline points="17 11 12 6 7 11"></polyline><polyline points="17 18 12 13 7 18"></polyline></svg>
                    {{ post.upvotes }}
                </small>
                {% if request.user.is_staff %}
                    <details>
                        <summary></summary>
                        <form method="POST" style="display:inline">
                            <input hidden name="hide-post" value="{{ post.pk }}">
                            <button onclick="event.preventDefault();if(confirm('¬øOcultar post?')){event.target.parentElement.submit()}">Ocultar post</button>
                        </form>
                        <form method="POST" style="display:inline">
                            <input hidden name="boost-post" value="{{ post.pk }}">
                            <button onclick="event.preventDefault();if(confirm('¬øImpulsar post?')){event.target.parentElement.submit()}">Impulsar post</button>
                        </form>
                        <form method="POST" style="display:inline">
                            <input hidden name="deprioritise-post" value="{{ post.pk }}">
                            <button onclick="event.preventDefault();if(confirm('Despriorizar post?')){event.target.parentElement.submit()}">Despriorizar post</button>
                        </form>
                        <form method="POST" style="display:inline">
                            <input hidden name="pin-post" value="{{ post.pk }}">
                            <button onclick="event.preventDefault();if(confirm('¬øFijar post?')){event.target.parentElement.submit()}">
                                {% if post.pinned %}Un-{% endif %}Fijar post
                            </button>
                        </form>
                        <form method="POST" style="display:inline">
                            <input hidden name="hide-blog" value="{{ post.pk }}">
                            <button onclick="event.preventDefault();if(confirm('¬øOcultar blog?')){event.target.parentElement.submit()}">Ocultar blog</button>
                        </form>
                        <form method="POST" style="display:inline">
                            <input hidden name="deprioritise-blog" value="{{ post.pk }}">
                            <button onclick="event.preventDefault();if(confirm('¬øDespriorizar blog?')){event.target.parentElement.submit()}">Despriorizar blog</button>
                        </form>
                        <form method="POST" style="display:inline">
                            <input hidden name="block-blog" value="{{ post.pk }}">
                            <button onclick="event.preventDefault();if(confirm('¬øBloquear blog?')){event.target.parentElement.submit()}">Bloquear blog</button>
                        </form>
                    </details>
                {% endif %}
            </small>
        </div>
    </li>
    {% empty %}
    <li>
        No hay m√°s posts para mostrar  ï„Éé‚Ä¢·¥•‚Ä¢ î„Éé Ô∏µ ‚îª‚îÅ‚îª
    </li>
    {% endfor %}
</ul>

<p>
    {% if previous_page >= 0 %}
    <a href="?page={{ previous_page }}{% if newest %}&newest=true{% endif %}">&laquo; Anterior</a> |
    {% endif %}
    {% if posts %}
    <a href="?page={{ next_page }}{% if newest %}&newest=true{% endif %}">Siguiente &raquo;</a>
    {% endif %}
</p>
<p>
    <i>
        Para recibir actualizaciones, usa el
        <a href="feed/{% if newest %}?newest=True{% endif %}">feed RSS</a>
    </i>
</p>
{% if not newest %}
<p>
    <small>
        <pre class="code">

Los posts son clasificados de acuerdo a la f√≥rmula:
Puntaje = log10(U) + (S / D * 8600)

Donde:
U = Votos positivos del post
S = Segundos transcurridos desde el 1 de enero de 2020
D = Modificador (actualmente=14)
        </pre>
    </small>
</p>
{% endif %}
{% endblock %}

{% block footer %}
<p>
    ¬øNo tienes blog? <a href="/accounts/signup/">Crea uno ac√°</a>.
</p>
{% endblock %}
